# Cache 란 무엇인가?
- ### 자주 사용되는 데이터를 빠르게 접근할 수 있도록 임시로 저장하는 고속 메모리입니다. 주로 성능 향상을 위해 사용한다.

- Cache에 데이터를 미리 복사해 놓으면 계산이나 접근 시간 없이 더 빠른 속도로 데이터에 접근할 수 있다. 결국 Cache란 반복적으로 데이터를 불러오는 경우에, 지속적으로 DBMS 혹은 서버에 요청하는 것이 아니라 Memory에 데이터를 저장하였다가 불러다 쓰는 것을 의미한다
- Cache는 저장공간이 작고 비용이 비싼 대신 빠른 성능을 제공한다.

| **장점**                          | **단점**                          |
|------------------------------------|-----------------------------------|
| **속도 향상**: 캐시된 데이터를 빠르게 접근할 수 있어 시스템 응답 속도가 빨라집니다. | **일관성 문제**: 캐시된 데이터가 최신 상태를 반영하지 않으면 잘못된 데이터를 반환할 수 있습니다. |
| **자원 절약**: 디스크 I/O나 네트워크 트래픽을 줄여 시스템 자원을 효율적으로 사용할 수 있습니다. | **메모리 소비**: 캐시된 데이터를 저장하기 위해 추가적인 메모리가 필요하고, 과도한 캐시로 인해 메모리 부족이 발생할 수 있습니다. |
| **응답 시간 단축**: 동일한 데이터를 반복해서 요청할 때 캐시에서 빠르게 응답할 수 있습니다. | **복잡성 증가**: 캐시 갱신, 만료, 무효화 등의 관리 로직이 복잡하고 시스템 설계를 어렵게 만들 수 있습니다. |
| **중복 작업 감소**: 동일한 데이터를 반복적으로 계산하거나 불러오는 작업을 줄여 시스템 효율성을 높입니다. | **성능 비용**: 캐시 미스가 발생하면 원본 데이터 소스에서 데이터를 다시 로드해야 하므로 성능 저하가 발생할 수 있습니다. |
| **자동화된 최적화**: LRU(Least Recently Used) 등 캐시 관리 전략을 통해 자동으로 데이터를 최적화할 수 있습니다. | **캐시 무효화 문제**: 캐시된 데이터가 변경되었을 때, 이를 갱신하거나 무효화하는 것이 복잡할 수 있습니다. |
| **캐시 미스 감소**: 동일한 데이터에 대해 반복적으로 요청 시 성능 향상을 기대할 수 있습니다. | **캐시의 제한된 유효성**: 캐시 데이터가 만료되거나, 유효하지 않게 되어 불필요한 비용이 발생할 수 있습니다. |

## 캐시 전략
- 캐시 전략이란, 데이터를 빠르게 저장하고 검색하기 위해 캐시를 어떻게 활용할지에 대한 규칙이나 방식을 말합니다. 캐시 전략은 데이터를 저장하는 방식, 갱신 주기, 언제 캐시를 사용하고 언제 갱신할지를 결정하여 성능 최적화와 자원 절약을 목표로 합니다.    

| **전략**            | **설명**                                          | **장점**                                         | **단점**                                         |
|---------------------|--------------------------------------------------|------------------------------------------------|------------------------------------------------|
| **Read-through**     | 데이터 요청 시 캐시에서 찾고, 없으면 원본 데이터 소스에서 읽어오는 방식. | 캐시가 자동 관리되어 코드가 간단함. 성능 향상.  | 캐시 미스가 발생하면 성능 저하.               |
| **Write-through**    | 데이터 변경 시 캐시와 원본 데이터 소스에 동시에 쓰는 방식. | 캐시와 원본 데이터 소스의 일관성 보장.          | 성능 저하가 발생할 수 있음.                   |
| **Write-behind**     | 캐시에 먼저 쓰고, 일정 시간이 지난 후 비동기적으로 원본 데이터 소스에 쓰는 방식. | 성능 향상, 비동기 처리로 부하 감소.            | 데이터 일관성 문제 발생 가능.                |
| **Cache-Aside**      | 애플리케이션이 캐시에서 데이터를 조회하고, 없으면 원본 데이터 소스에서 읽어와 캐시에 저장하는 방식. | 캐시 관리 유연성. 효율적 데이터 로드.         | 캐시 갱신 및 무효화 관리 책임이 애플리케이션에 있음. |
[Caching 전략 소개 및 사용 예제 블로그](https://wnsgml972.github.io/database/2020/12/13/Caching/)

# 캐시 스탬피드 (Cache Stampede)

**캐시 스탬피드**는 여러 클라이언트가 동시에 동일한 데이터를 요청할 때 발생하는 성능 문제입니다. 이 문제는 여러 요청이 동시에 캐시 미스를 일으키고, 그로 인해 원본 데이터 소스에서 데이터를 동시에 가져오려는 경쟁 상태가 발생합니다. 이로 인해 시스템의 성능이 급격히 저하될 수 있습니다.

## 캐시 스탬피드 발생 과정
1. **캐시 미스**: 여러 클라이언트가 동일한 데이터를 요청할 때, 캐시에서 해당 데이터를 찾지 못하는 상황이 발생합니다.
2. **동시 요청**: 캐시 미스로 인해 각 클라이언트는 원본 데이터 소스에서 동일한 데이터를 동시에 가져오려고 시도합니다.
3. **부하 증가**: 원본 데이터 소스에는 불필요한 중복 요청이 발생하고, 이로 인해 데이터 소스에 과도한 부하가 걸리며 성능이 저하됩니다.

## 캐시 스탬피드의 문제점
- **성능 저하**: 동일한 데이터를 여러 번 요청하게 되어 원본 데이터 소스에 불필요한 부하를 주어 성능이 크게 저하됩니다.
- **리소스 낭비**: 중복된 데이터 요청이 반복되므로 시스템 자원을 낭비하게 됩니다.
- **응답 지연**: 데이터 소스의 부하가 증가하면, 전체 시스템의 응답 속도가 느려질 수 있습니다.

## 요약
캐시 스탬피드는 여러 클라이언트가 동시에 캐시 미스를 일으켜 원본 데이터 소스에 과도한 부하를 주는 문제로, 성능 저하와 리소스 낭비를 초래할 수 있습니다.

# 캐시 스탬피드 해결 방법

캐시 스탬피드 문제를 해결하려면, 여러 클라이언트가 동시에 동일한 데이터를 요청할 때 원본 데이터 소스에 과도한 부하가 걸리지 않도록 전략을 적용해야 합니다. 다음은 이를 해결하는 방법들입니다.

## 1. 락(Lock) 사용
- **개념**: 하나의 요청만 원본 데이터 소스에 접근하도록 하고, 나머지 요청은 기다리게 하여 중복된 요청을 방지합니다.
- **방법**: Redis와 같은 분산 시스템에서 `SETNX`와 같은 락 명령어를 사용하여, 첫 번째 요청이 데이터 소스에 접근할 때 다른 요청들이 대기하도록 처리합니다.

## 2. Lazy Loading with Refresh
- **개념**: 캐시가 만료되었을 때 한 요청만 데이터 소스에 접근하고, 다른 요청들은 캐시가 갱신되면 그 결과를 받도록 합니다.
- **방법**: 첫 번째 요청이 데이터 소스에서 데이터를 로드하고, 이후 요청들은 캐시가 갱신될 때까지 기다리도록 처리합니다.

## 3. 캐시 갱신 정책
- **개념**: 캐시된 데이터를 일정 시간 후 만료되거나 주기적으로 갱신하여 캐시 미스를 방지합니다.
- **방법**: 캐시의 만료 시간을 설정하거나, 데이터를 일정 간격으로 갱신하여 캐시가 항상 최신 상태를 유지하도록 합니다.

## 4. 사전 로딩(Prefetching)
- **개념**: 예상되는 데이터를 미리 캐시해 놓아 캐시 미스 상황을 줄입니다.
- **방법**: 자주 요청될 것으로 예상되는 데이터를 미리 캐시하여, 캐시 미스를 줄이고 성능을 향상시킵니다.

## 요약
캐시 스탬피드를 해결하기 위해서는 락을 사용하여 중복 요청을 방지하거나, 첫 번째 요청만 원본 데이터 소스에 접근하게 하는 방법을 적용할 수 있습니다. 또한, 캐시 갱신 정책과 사전 로딩을 활용하여 데이터 소스에 불필요한 요청을 줄일 수 있습니다.

## 이커머스에서 캐시를 사용해야하는 적정 시나리오

# Redis 활용 방안

## 1. 상위 상품 목록 조회에 Redis 캐시 적용

### **적용 이유**
- **반복적인 조회**: 상위 상품 목록은 자주 조회되지만 자주 변경되지 않는 데이터일 가능성이 높습니다. 예를 들어, 인기 상품 목록은 하루에 몇 번만 갱신되거나 특정 이벤트에 따라 갱신됩니다.
- **빠른 응답**: Redis는 메모리 기반으로 빠른 데이터 조회가 가능하여, 상품 목록을 빠르게 로드할 수 있습니다.
- **부하 절감**: 상위 상품 목록을 캐시하면 반복적으로 데이터베이스를 조회하는 부하를 줄일 수 있습니다. 특히, 많은 사용자가 동시에 이 목록을 조회할 때 성능 저하를 방지할 수 있습니다.

### **이점**
- **빠른 조회**: 캐시된 상위 상품 목록을 빠르게 조회하여, 응답 시간을 단축시킬 수 있습니다.
- **성능 개선**: 많은 사용자가 동시에 조회할 때도 성능 저하 없이 빠르게 처리할 수 있습니다.
- **시스템 효율성**: 캐시된 데이터를 사용하여 데이터베이스의 부하를 줄이고, 시스템의 효율성을 높일 수 있습니다.

---

## 2. 쿠폰 발급에 Redis의 기능 활용

### **적용 이유**
- **중복 발급 방지**: Redis의 **SETNX** 명령어를 사용하여, 쿠폰이 중복으로 발급되지 않도록 **락(Lock)**을 적용할 수 있습니다.
- **고성능 세션 관리**: Redis는 세션 정보를 빠르게 조회하고 관리할 수 있어, 쿠폰 발급에 필요한 세션 관리가 효율적입니다.
- **실시간 이벤트 처리**: Redis의 **Pub/Sub** 기능을 사용하여 쿠폰 발급 이벤트를 실시간으로 처리할 수 있습니다.

### **이점**
- **중복 발급 방지**: Redis의 **SETNX** 명령어로 쿠폰 발급 중복을 방지할 수 있습니다.
- **고속 처리**: Redis는 빠른 읽기/쓰기가 가능하여 쿠폰 발급 요청을 신속하게 처리할 수 있습니다.
- **세션 관리**: 쿠폰 발급 시 사용자의 세션을 Redis에서 효율적으로 관리하여, 빠르게 상태를 추적하고 관리할 수 있습니다.
- **실시간 처리**: Redis의 **Pub/Sub** 기능을 사용해 실시간으로 쿠폰 발급과 관련된 이벤트를 처리하고 알림을 보낼 수 있습니다.

